# Copyright (C) 2018 Johann Lee <me@qinka.pro>
#
# This file is part of Haskell-FAI.
#
# Haskell-FAI is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Haskell-FAI is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Haskell-FAI. If not, see <http://www.gnu.org/licenses/>.
#

## Traivs-Ci configure
sudo: required
dist: trusty

addons:
  apt:
    update: true
    sources:
      - hvr-ghc
    packages:
      - wget
      - curl
      - nvidia-cuda-toolkit

# Matrix of building
env:
  - TASK=FAI GHC_VER=8.2.2 THREADED=t LLVM=3.9 DEBUG=t RUN_TEST=t
  - TASK=FAI GHC_VER=8.2.2            LLVM=3.9 DEBUG=t RUN_TEST=t
  - TASK=FAI GHC_VER=8.2.2 THREADED=t          DEBUG=t RUN_TEST=t
  - TASK=FAI GHC_VER=8.2.2                     DEBUG=t RUN_TEST=t


before_install: |
  source $TRAVIS_BUILD_DIR/.ci/travis_ci_script.sh
  echo init
  common_init
  case $TASK in
    FAI)
      FAI_init
    ;;
    *)
      echo $TASK nothing to do
    ;;
  esac

script: |
  echo Build and test
  case $TASK in
    FAI)
      FAI_build
      FAI_test
    ;;
    *)
      echo $TASK nothing to do
    ;;
  esac
after_success: |
  echo after success
  case $TASK in
    FAI)
      FAI_succ
    ;;
    *)
      echo $TASK nothing to do
    ;;
  esac

deploy:
  provider: script
  script: bash $TRAVIS_BUILD_DIR/.travisci/deploy.sh
  
  

